Index: 3.4.0/src/kvirc/sparser/kvi_sp_ctcp.cpp
===================================================================
--- 3.4.0/src/kvirc/sparser/kvi_sp_ctcp.cpp	(revisión: 1996)
+++ 3.4.0/src/kvirc/sparser/kvi_sp_ctcp.cpp	(revisión: 1997)
@@ -60,6 +60,11 @@
 
 #include <qdatetime.h>
 
+#ifdef COMPILE_USE_QT4
+	#include <QTextDocument>
+#else
+	#include <qstylesheet.h>
+#endif
 
 
 
@@ -1445,7 +1450,11 @@
 				QString szMsg = "<b>";
 				szMsg += msg->pSource->nick();
 				szMsg += "</b> ";
-				szMsg += szData;
+				#ifdef COMPILE_USE_QT4
+					szMsg += Qt::escape(szData);
+				#else
+					szMsg += QStyleSheet::escape(szData);
+				#endif
 				//debug("kvi_sp_ctcp.cpp:975 debug: %s",szMsg.data());
 				g_pApp->notifierMessage(pOut,KVI_OPTION_MSGTYPE(KVI_OUT_ACTION).pixId(),szMsg,90);
 			}
Index: 3.4.0/src/kvirc/sparser/kvi_sp_literal.cpp
===================================================================
--- 3.4.0/src/kvirc/sparser/kvi_sp_literal.cpp	(revisión: 1996)
+++ 3.4.0/src/kvirc/sparser/kvi_sp_literal.cpp	(revisión: 1997)
@@ -72,6 +72,12 @@
 //#include "kvi_iconmanager.h"
 #include <qdatetime.h>
 
+#ifdef COMPILE_USE_QT4
+	#include <QTextDocument>
+#else
+	#include <qstylesheet.h>
+#endif
+
 extern KviNickServRuleSet * g_pNickServRuleSet;
 
 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
@@ -910,15 +916,12 @@
 					{
 						// don't send the message to the notifier twice
 						iFlags |= KviConsole::NoNotifier;
-						QString szMsg = "";
-						//QString szMsg = "<b>&lt;";
-						//szMsg += szNick;
-						//szMsg += "&gt;</b> ";
-						QString szHtml = szMsgText;
-						szHtml.replace("<","&lt;");
-						szHtml.replace(">","&gt;");
-						szMsg += szHtml;
-						//debug("kvi_sp_literal.cpp:908 debug: %s",szHtml.data());
+						#ifdef COMPILE_USE_QT4
+							QString szMsg = Qt::escape(szMsgText); 
+						#else
+							QString szMsg = QStyleSheet::escape(szMsgText);
+						#endif
+						//debug("kvi_sp_literal.cpp:908 debug: %s",szMsg.data());
 						g_pApp->notifierMessage(query,KVI_SMALLICON_QUERYPRIVMSG,szMsg,1800);
 					}
 				}
@@ -1271,15 +1274,12 @@
 					{
 						// don't send the message twice to the notifier
 						iFlags |= KviConsole::NoNotifier;
-						QString szMsg = "";
-						//QString szMsg = "<b>&lt;";
-						//szMsg += szNick;
-						//szMsg += "&gt;</b> ";
-						QString szHtml = szMsgText;
-						szHtml.replace("<","&lt;");
-						szHtml.replace(">","&gt;");
-						szMsg += szHtml;
-						//debug("kvi_sp_literal.cpp:1262 debug: %s",szHtml.data());
+						#ifdef COMPILE_USE_QT4
+							QString szMsg = Qt::escape(szMsgText); 
+						#else
+							QString szMsg = QStyleSheet::escape(szMsgText);
+						#endif
+						//debug("kvi_sp_literal.cpp:908 debug: %s",szMsg.data());
 						g_pApp->notifierMessage(query,KVI_SMALLICON_QUERYNOTICE,szMsg,1800);
 					}
 				}
Index: 3.4.0/src/kvirc/kernel/kvi_app.cpp
===================================================================
--- 3.4.0/src/kvirc/kernel/kvi_app.cpp	(revisión: 1996)
+++ 3.4.0/src/kvirc/kernel/kvi_app.cpp	(revisión: 1997)
@@ -109,6 +109,12 @@
 #endif
 #endif
 
+#ifdef COMPILE_USE_QT4
+	#include <QTextDocument>
+#else
+	#include <qstylesheet.h>
+#endif
+
 KVIRC_API KviApp                       * g_pApp                    = 0; // global application pointer
 
 KviConfig                              * g_pWinPropertiesConfig    = 0;
@@ -1048,7 +1054,11 @@
 				szMsg += szLocalFileName;
 				szMsg += ")";
 			}
-			notifierMessage(0,iIconId,szMsg,30);
+#ifdef COMPILE_USE_QT4
+			notifierMessage(0,iIconId,Qt::escape(szMsg),30); 
+#else
+			notifierMessage(0,iIconId,QStyleSheet::escape(szMsg),30);
+#endif
 		}
 		return;
 	}
Index: 3.4.0/src/kvirc/ui/kvi_console.cpp
===================================================================
--- 3.4.0/src/kvirc/ui/kvi_console.cpp	(revisión: 1996)
+++ 3.4.0/src/kvirc/ui/kvi_console.cpp	(revisión: 1997)
@@ -97,6 +97,11 @@
 #define __KVI_DEBUG__
 #include "kvi_debug.h"
 
+#ifdef COMPILE_USE_QT4
+	#include <QTextDocument>
+#else
+	#include <qstylesheet.h>
+#endif
 
 extern KVIRC_API KviIrcServerDataBase           * g_pIrcServerDataBase;
 extern KVIRC_API KviProxyDataBase               * g_pProxyDataBase;
@@ -762,7 +767,11 @@
 					QString szMsg = "<b>&lt;";
 					szMsg += nick;
 					szMsg += "&gt;</b> ";
-					szMsg += szDecodedMessage;
+					#ifdef COMPILE_USE_QT4
+						szMsg += Qt::escape(szDecodedMessage);
+					#else
+						szMsg += QStyleSheet::escape(szDecodedMessage);
+					#endif
 					//debug("kvi_console.cpp:629 debug: %s",szMsg.data());
 					g_pApp->notifierMessage(wnd,KVI_OPTION_MSGTYPE(iSaveType).pixId(),szMsg,90);
 				}
